<!-- templates/meal_planner/calendar.html -->
{% extends 'meal_planner/base.html' %}

{% block title %}Calendrier des Repas | {{ block.super }}{% endblock %}

{% block content %}
<div class="row mb-3">
    <div class="col-md-6">
        <h1>Calendrier des repas</h1>
    </div>
    <div class="col-md-6 text-md-end">
        <div class="btn-group" role="group">
            <a href="?{{ prev_month }}" class="btn btn-outline-primary">&laquo; Mois précédent</a>
            <a href="?{{ next_month }}" class="btn btn-outline-primary">Mois suivant &raquo;</a>
        </div>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header text-center">
        <h3>{{ current_month }}</h3>
    </div>
    <div class="card-body">
        {{ calendar }}
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="d-flex mb-4">
            <span class="me-3"><span class="badge bg-warning">&nbsp;</span> Petit-déjeuner</span>
            <span class="me-3"><span class="badge bg-success">&nbsp;</span> Déjeuner</span>
            <span><span class="badge bg-info">&nbsp;</span> Dîner</span>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Rediriger vers la page du jour quand on clique sur une cellule
    document.querySelectorAll('td.day').forEach(function(cell) {
        cell.addEventListener('click', function(e) {
            // Ne rediriger que si on clique sur la cellule (pas sur un repas existant)
            if (e.target === cell || e.target.classList.contains('date')) {
                const day = cell.querySelector('.date').textContent;
                const currentMonth = '{{ current_month }}'.split(' ');
                
                // Obtenir le mois en numérique
                const months = {
                    'January': 1, 'February': 2, 'March': 3, 'April': 4, 'May': 5, 'June': 6,
                    'July': 7, 'August': 8, 'September': 9, 'October': 10, 'November': 11, 'December': 12,
                    'Janvier': 1, 'Février': 2, 'Mars': 3, 'Avril': 4, 'Mai': 5, 'Juin': 6,
                    'Juillet': 7, 'Août': 8, 'Septembre': 9, 'Octobre': 10, 'Novembre': 11, 'Décembre': 12
                };
                
                const month = months[currentMonth[0]] || 1;
                const year = currentMonth[1] || new Date().getFullYear();
                
                window.location.href = `/day/${year}/${month}/${day}/`;
            }
        });
    });
</script>
{% endblock %}